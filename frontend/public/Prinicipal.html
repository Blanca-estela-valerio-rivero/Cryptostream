<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidReward - Gana con Stellar</title>
    <style>
        /* Tu CSS actual */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .navbar { background: rgba(255, 255, 255, 0.95); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-size: 1.8rem; font-weight: bold; color: #667eea; display: flex; align-items: center; gap: 0.5rem; }
        .stellar-badge { background: linear-gradient(135deg, #7b16ff, #b116ff); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; }
        .nav-buttons { display: flex; gap: 1rem; align-items: center; }
        .btn { padding: 0.7rem 1.5rem; border: none; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; font-weight: bold; }
        .btn-freighter { background: linear-gradient(135deg, #7b16ff, #b116ff); color: white; }
        .btn-freighter:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(123, 22, 255, 0.4); }
        .btn-freighter:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-connected { background: #27ae60 !important; }
        .hero { text-align: center; padding: 4rem 2rem; color: white; }
        .hero h1 { font-size: 3rem; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .hero p { font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.95; }
        .blockchain-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 1rem 2rem; border-radius: 50px; margin-bottom: 2rem; border: 2px solid rgba(255,255,255,0.3); }
        .wallet-info { background: rgba(255,255,255,0.95); padding: 1.5rem; border-radius: 15px; max-width: 600px; margin: 2rem auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: none; }
        .wallet-connected { display: flex; align-items: center; gap: 1rem; justify-content: space-between; flex-wrap: wrap; }
        .wallet-address { font-family: monospace; background: #f0f0f0; padding: 0.8rem 1.2rem; border-radius: 8px; font-size: 0.95rem; color: #333; word-break: break-all; }
        .notification { position: fixed; top: 20px; right: 20px; background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); display: none; z-index: 1000; min-width: 300px; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.success { border-left: 4px solid #27ae60; } 
        .notification.error { border-left: 4px solid #e74c3c; } 
        .notification.info { border-left: 4px solid #3498db; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">üì∫ CRYPTOSTREAM
            <div class="stellar-badge">‚≠ê Stellar Network</div>
        </div>
        <div class="nav-buttons">
            <button class="btn btn-freighter" id="connectBtn" onclick="connectFreighter()">üîó Conectar Freighter</button>
        </div>
    </nav>

    <section class="hero">
        <div class="blockchain-badge">‚õìÔ∏è Powered by Stellar Blockchain</div>
        <h1>üé¨ Gana Criptomonedas Viendo Videos</h1>
        <p>Recibe pagos instant√°neos en XLM directamente en tu wallet de Freighter</p>
        <button class="btn btn-freighter" onclick="goToDashboard()" style="font-size:1.2rem; padding:1rem 2rem;">Comenzar Ahora üöÄ</button>
    </section>

    <div class="wallet-info" id="walletInfo">
        <div class="wallet-connected">
            <div style="flex:1;">
                <strong style="color:#27ae60;">‚úÖ Wallet Conectada</strong>
                <div class="wallet-address" id="walletAddress"></div>
            </div>
            <button class="btn btn-freighter btn-connected" onclick="goToDashboard()">Ver Videos ‚Üí</button>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/11.2.2/stellar-sdk.min.js"></script>
    <script>
        let publicKey = null;
        let server = null;

        async function connectFreighter() {
            const btn = document.getElementById('connectBtn');
            if (!window.freighterApi) {
                showNotification('‚ö†Ô∏è Freighter no est√° instalado', 'error');
                setTimeout(() => window.open('https://www.freighter.app/', '_blank'), 2000);
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '‚è≥ Conectando...';

            try {
                const isConnected = await window.freighterApi.isConnected();
                if (!isConnected) {
                    showNotification('‚ö†Ô∏è Desbloquea tu Freighter Wallet', 'error');
                    btn.disabled = false;
                    btn.innerHTML = 'üîó Conectar Freighter';
                    return;
                }

                publicKey = await window.freighterApi.getPublicKey();
                server = new StellarSdk.Server('https://horizon-testnet.stellar.org');
                localStorage.setItem('stellarPublicKey', publicKey);

                document.getElementById('walletAddress').textContent = publicKey;
                document.getElementById('walletInfo').style.display = 'block';
                btn.innerHTML = '‚úÖ Conectado';
                btn.classList.add('btn-connected');
                btn.disabled = true;

                await checkBalance();
                setTimeout(goToDashboard, 1000);

            } catch (e) {
                console.error(e);
                showNotification('‚ùå Error: ' + e.message, 'error');
                btn.disabled = false;
                btn.innerHTML = 'üîó Conectar Freighter';
            }
        }

        async function checkBalance() {
            try {
                const account = await server.loadAccount(publicKey);
                const balance = account.balances.find(b => b.asset_type==='native').balance;
                showNotification(`üí∞ Balance: ${parseFloat(balance).toFixed(2)} XLM`, 'info');
            } catch(e) {
                console.error(e);
                showNotification('‚ö†Ô∏è Cuenta no financiada en Testnet', 'error');
                setTimeout(()=>window.open('https://laboratory.stellar.org/#account-creator?network=test','_blank'),2000);
            }
        }

        function goToDashboard() {
            if (!publicKey) { showNotification('‚ùå Primero conecta tu wallet','error'); return; }
            window.location.href = 'video.html';
        }

        function showNotification(msg, type) {
            const n = document.getElementById('notification');
            n.textContent = msg;
            n.className = 'notification ' + type;
            n.style.display = 'block';
            setTimeout(()=> n.style.display='none',5000);
        }

        window.addEventListener('load', async () => {
            const savedKey = localStorage.getItem('stellarPublicKey');
            if (savedKey && window.freighterApi) {
                try {
                    const connected = await window.freighterApi.isConnected();
                    if (connected) {
                        const currentKey = await window.freighterApi.getPublicKey();
                        if (currentKey===savedKey) {
                            publicKey=currentKey;
                            server=new StellarSdk.Server('https://horizon-testnet.stellar.org');
                            document.getElementById('walletAddress').textContent=publicKey;
                            document.getElementById('walletInfo').style.display='block';
                            const btn=document.getElementById('connectBtn');
                            btn.innerHTML='‚úÖ Conectado';
                            btn.classList.add('btn-connected');
                            btn.disabled=true;
                        }
                    }
                } catch(e){ console.error(e); localStorage.removeItem('stellarPublicKey'); }
            }
        });
    </script>
</body>
</html>
